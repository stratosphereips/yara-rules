# ipv6range2yara.py
Generate basic yara rules to search for specific IPv6 block lists.

### Dependencies
* Python 3
* [tenjin](http://www.kuwata-lab.com/tenjin/)

Country ranges are retrieved from [ipverse.net](http://ipverse.net/) so obviously you will need an Internet connection.

## Create your first yara rule!

1) Retrieve country block lists:
```bash
$ ./get.sh
[+] IPv6 range for country ad
[+] IPv6 range for country ae
[+] IPv6 range for country af
[+] IPv6 range for country ag
[+] IPv6 range for country ai
[+] IPv6 range for country al
[+] IPv6 range for country am
[+] IPv6 range for country ao
[+] IPv6 range for country aq
[+] IPv6 range for country ar
[+] IPv6 range for country as
...
$ ls -d countries
countries
```

The `countries` directory will be created and will hold the IPv6 block lists files. These are used to generate the yara rules.

2) Generate the yara rule for an specific country range:
```bash
$ python3 ipv6range2yara.py ad
// automatically generated rule
import "elf"

rule ipv6_ad_range {
  strings:
    $addr0 = "2a02:8060:" ascii
  condition:
    // uint32(0) == 0x7F454C46
    elf.type == elf.ET_EXEC
      and any of ($addr*)
}
```

Yara rule will be print to STDOUT so you can copy it or pipe it to a file. In this example we generated a yara rule for Andora (`ad`) which it has only one IPv6 block.

### Customize
Yara rules generated by this script can be customized by modifying the template file `rule.pyyar`. For example, the default template was created to search for ELF type binaries but we can customize it to search for PE executables and case insensitive:
```json
// automatically generated rule

rule ipv6_${cr}_range {
  strings:
<?py for i,a in enumerate(addrs): ?>
    $addr${i} = "${a}" nocase
<?py #endfor ?>
  condition:
    uint16(0) == 0x5a4d // MZ
      and any of ($addr*)
}
```


## Contributors
* Lisandro Ubiedo ([lubiedo](github.com/lubiedo))

### Thanks
[ipverse.net](http://ipverse.net/) for keeping an up-to-date list and providing the resource open and free to use.

